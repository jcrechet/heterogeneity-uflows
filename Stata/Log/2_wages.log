------------------------------------------------------------------------------------------------------------
      name:  <unnamed>
       log:  C:\Users\jcrechet\Dropbox\Research\Projects\Heterogeneity_Uflows\Submissions\EER-April 2022\Acc
> epted2023\Replication_files\Stata\Log\2_wages.log
  log type:  text
 opened on:  14 Mar 2023, 19:53:28

. 
. * data
. use "$working_dir\Dta\CPS_data", clear

. 
. * variables
. keep year month cpsidp mish earnwt empstat age hourwage paidhour earnweek uhrswork1 ahrswork1 classwkr 

. 
. * ORG samples
. keep if mish == 4 | mish == 8
(18,165,612 observations deleted)

. 
. * Merge with CPI99
. merge m:1 year using "$working_dir\Dta\cpi99"

    Result                           # of obs.
    -----------------------------------------
    not matched                            34
        from master                         0  (_merge==1)
        from using                         34  (_merge==2)

    matched                         6,121,946  (_merge==3)
    -----------------------------------------

. rename cpi cpi99

. 
. * age restrictions
. keep if age >= 20 & age <= 60
(1,079,029 observations deleted)

. 
. ** LF status restriction
.  * employed
. keep if empstat >= 10 & empstat <= 12
(1,182,209 observations deleted)

. 
. * exclude self-employed 
. keep if classwkr >= 22 & classwkr <= 28
(409,747 observations deleted)

. 
. 
. **
. **
. 
. * weekly earnings descriptives
. sum earnweek, d

                       weekly earnings
-------------------------------------------------------------
      Percentiles      Smallest
 1%         67.2            .01
 5%          165            .01
10%          240            .01       Obs           3,450,995
25%       384.61            .01       Sum of Wgt.   3,450,995

50%          615                      Mean           790.9262
                        Largest       Std. Dev.      694.5769
75%         1000        9999.99
90%         1538        9999.99       Variance       482437.1
95%      1961.53        9999.99       Skewness       5.128129
99%      2884.61        9999.99       Kurtosis       59.10616

. 
. **
. **
. 
. ** identify top codes 
. * (see https://cps.ipums.org/cps-action/variables/EARNWEEK#codes_section)
. gen topcode = 0

. 
. * 1989-1997
. replace topcode = 1 if earnweek >= 1923 & year >= 1989 & year <= 1997
(5,815 real changes made)

. 
. * 1998-onward
. replace topcode = 1 if earnweek >= 2884.61 & year >= 1998 & year <= 2023
(67,566 real changes made)

. 
. 
. **
. **
. 
. * nomimal hourly earnings: worker paid by hourly wage
. gen nominal_wage = hourwage if paidhour == 2
(1,439,142 missing values generated)

. 
. * salary workers
. replace nominal_wage = earnweek / uhrswork1 if paidhour == 1 & uhrswork1 >= 1 & uhrswork1 <= 99
(1,355,660 real changes made)

. 
. * workers declaring variable hours: use actual hours
. replace nominal_wage = earnweek / ahrswork1 if paidhour == 1 & uhrswork1 == 997 & ahrswork1 >= 1 & ahrswor
> k1 <= 99 
(78,249 real changes made)

. 
. * count missing
. count if nominal_wage == .
  5,233

. 
. * distribution
. sum nominal_wage, d

                        nominal_wage
-------------------------------------------------------------
      Percentiles      Smallest
 1%         3.63        .000101
 5%         6.25       .0001176
10%          7.5        .000125       Obs           3,445,762
25%           10        .000125       Sum of Wgt.   3,445,762

50%           15                      Mean           19.81413
                        Largest       Std. Dev.      45.64634
75%     23.07675        9999.99
90%           35        9999.99       Variance       2083.589
95%       45.673        9999.99       Skewness       107.2578
99%         72.1        9999.99       Kurtosis       19751.95

. 
. * real wage
. gen real_wage = nominal_wage * cpi99
(5,233 missing values generated)

. sum real_wage, d

                          real_wage
-------------------------------------------------------------
      Percentiles      Smallest
 1%      3.14275       .0000868
 5%     5.714286       .0000894
10%        6.534       .0000914       Obs           3,445,762
25%      8.61175       .0000939       Sum of Wgt.   3,445,762

50%      12.7035                      Mean           16.57945
                        Largest       Std. Dev.      40.10663
75%       19.404       10379.99
90%      28.7541       10619.99       Variance       1608.542
95%         36.5       10619.99       Skewness       113.8891
99%       53.144       11239.99       Kurtosis        22271.3

. 
. **
. **
. 
. * top coded: times 1.4. (Lemieux, 2006)
. replace real_wage = real_wage * 1.4 if topcode == 1
(72,920 real changes made)

. 
. * "trim" bottom and top 1% (by year) to eliminate outliers and top coded
. by year, sort: egen bottom = pctile(real_wage), p(1)

. by year: tab bottom

------------------------------------------------------------------------------------------------------------
-> year = 1995

     bottom |      Freq.     Percent        Cum.
------------+-----------------------------------
       2.81 |     50,326      100.00      100.00
------------+-----------------------------------
      Total |     50,326      100.00

------------------------------------------------------------------------------------------------------------
-> year = 1996

     bottom |      Freq.     Percent        Cum.
------------+-----------------------------------
    3.00575 |    136,288      100.00      100.00
------------+-----------------------------------
      Total |    136,288      100.00

------------------------------------------------------------------------------------------------------------
-> year = 1997

     bottom |      Freq.     Percent        Cum.
------------+-----------------------------------
   3.034286 |    138,858      100.00      100.00
------------+-----------------------------------
      Total |    138,858      100.00

------------------------------------------------------------------------------------------------------------
-> year = 1998

     bottom |      Freq.     Percent        Cum.
------------+-----------------------------------
      3.114 |    140,225      100.00      100.00
------------+-----------------------------------
      Total |    140,225      100.00

------------------------------------------------------------------------------------------------------------
-> year = 1999

     bottom |      Freq.     Percent        Cum.
------------+-----------------------------------
    3.13754 |    142,053      100.00      100.00
------------+-----------------------------------
      Total |    142,053      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2000

     bottom |      Freq.     Percent        Cum.
------------+-----------------------------------
    3.28825 |    143,616      100.00      100.00
------------+-----------------------------------
      Total |    143,616      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2001

     bottom |      Freq.     Percent        Cum.
------------+-----------------------------------
     3.1911 |    157,542      100.00      100.00
------------+-----------------------------------
      Total |    157,542      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2002

     bottom |      Freq.     Percent        Cum.
------------+-----------------------------------
   3.117063 |    164,246      100.00      100.00
------------+-----------------------------------
      Total |    164,246      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2003

     bottom |      Freq.     Percent        Cum.
------------+-----------------------------------
    2.89375 |    161,190      100.00      100.00
------------+-----------------------------------
      Total |    161,190      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2004

     bottom |      Freq.     Percent        Cum.
------------+-----------------------------------
    3.12225 |    157,798      100.00      100.00
------------+-----------------------------------
      Total |    157,798      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2005

     bottom |      Freq.     Percent        Cum.
------------+-----------------------------------
      3.087 |    158,779      100.00      100.00
------------+-----------------------------------
      Total |    158,779      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2006

     bottom |      Freq.     Percent        Cum.
------------+-----------------------------------
   3.269833 |    157,881      100.00      100.00
------------+-----------------------------------
      Total |    157,881      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2007

     bottom |      Freq.     Percent        Cum.
------------+-----------------------------------
     3.0975 |    156,063      100.00      100.00
------------+-----------------------------------
      Total |    156,063      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2008

     bottom |      Freq.     Percent        Cum.
------------+-----------------------------------
      3.216 |    153,698      100.00      100.00
------------+-----------------------------------
      Total |    153,698      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2009

     bottom |      Freq.     Percent        Cum.
------------+-----------------------------------
      3.096 |    148,957      100.00      100.00
------------+-----------------------------------
      Total |    148,957      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2010

     bottom |      Freq.     Percent        Cum.
------------+-----------------------------------
      3.108 |    147,273      100.00      100.00
------------+-----------------------------------
      Total |    147,273      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2011

     bottom |      Freq.     Percent        Cum.
------------+-----------------------------------
      3.247 |    145,307      100.00      100.00
------------+-----------------------------------
      Total |    145,307      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2012

     bottom |      Freq.     Percent        Cum.
------------+-----------------------------------
     3.0875 |    144,530      100.00      100.00
------------+-----------------------------------
      Total |    144,530      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2013

     bottom |      Freq.     Percent        Cum.
------------+-----------------------------------
      3.267 |    143,780      100.00      100.00
------------+-----------------------------------
      Total |    143,780      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2014

     bottom |      Freq.     Percent        Cum.
------------+-----------------------------------
    3.11025 |    144,143      100.00      100.00
------------+-----------------------------------
      Total |    144,143      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2015

     bottom |      Freq.     Percent        Cum.
------------+-----------------------------------
   3.128889 |    142,008      100.00      100.00
------------+-----------------------------------
      Total |    142,008      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2016

     bottom |      Freq.     Percent        Cum.
------------+-----------------------------------
    3.33925 |    141,786      100.00      100.00
------------+-----------------------------------
      Total |    141,786      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2017

     bottom |      Freq.     Percent        Cum.
------------+-----------------------------------
       3.47 |    139,326      100.00      100.00
------------+-----------------------------------
      Total |    139,326      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2018

     bottom |      Freq.     Percent        Cum.
------------+-----------------------------------
      3.395 |    135,322      100.00      100.00
------------+-----------------------------------
      Total |    135,322      100.00


. 
. by year, sort: egen top = pctile(real_wage), p(99)

. by year: tab top

------------------------------------------------------------------------------------------------------------
-> year = 1995

        top |      Freq.     Percent        Cum.
------------+-----------------------------------
   60.52065 |     50,326      100.00      100.00
------------+-----------------------------------
      Total |     50,326      100.00

------------------------------------------------------------------------------------------------------------
-> year = 1996

        top |      Freq.     Percent        Cum.
------------+-----------------------------------
   58.85149 |    136,288      100.00      100.00
------------+-----------------------------------
      Total |    136,288      100.00

------------------------------------------------------------------------------------------------------------
-> year = 1997

        top |      Freq.     Percent        Cum.
------------+-----------------------------------
   57.18233 |    138,858      100.00      100.00
------------+-----------------------------------
      Total |    138,858      100.00

------------------------------------------------------------------------------------------------------------
-> year = 1998

        top |      Freq.     Percent        Cum.
------------+-----------------------------------
   62.37965 |    140,225      100.00      100.00
------------+-----------------------------------
      Total |    140,225      100.00

------------------------------------------------------------------------------------------------------------
-> year = 1999

        top |      Freq.     Percent        Cum.
------------+-----------------------------------
   68.78826 |    142,053      100.00      100.00
------------+-----------------------------------
      Total |    142,053      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2000

        top |      Freq.     Percent        Cum.
------------+-----------------------------------
   67.30756 |    143,616      100.00      100.00
------------+-----------------------------------
      Total |    143,616      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2001

        top |      Freq.     Percent        Cum.
------------+-----------------------------------
     70.591 |    157,542      100.00      100.00
------------+-----------------------------------
      Total |    157,542      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2002

        top |      Freq.     Percent        Cum.
------------+-----------------------------------
   69.09428 |    164,246      100.00      100.00
------------+-----------------------------------
      Total |    164,246      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2003

        top |      Freq.     Percent        Cum.
------------+-----------------------------------
   67.99288 |    161,190      100.00      100.00
------------+-----------------------------------
      Total |    161,190      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2004

        top |      Freq.     Percent        Cum.
------------+-----------------------------------
   68.65933 |    157,798      100.00      100.00
------------+-----------------------------------
      Total |    157,798      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2005

        top |      Freq.     Percent        Cum.
------------+-----------------------------------
   71.23833 |    158,779      100.00      100.00
------------+-----------------------------------
      Total |    158,779      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2006

        top |      Freq.     Percent        Cum.
------------+-----------------------------------
   68.89603 |    157,881      100.00      100.00
------------+-----------------------------------
      Total |    157,881      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2007

        top |      Freq.     Percent        Cum.
------------+-----------------------------------
    68.7232 |    156,063      100.00      100.00
------------+-----------------------------------
      Total |    156,063      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2008

        top |      Freq.     Percent        Cum.
------------+-----------------------------------
   72.15372 |    153,698      100.00      100.00
------------+-----------------------------------
      Total |    153,698      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2009

        top |      Freq.     Percent        Cum.
------------+-----------------------------------
   69.46141 |    148,957      100.00      100.00
------------+-----------------------------------
      Total |    148,957      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2010

        top |      Freq.     Percent        Cum.
------------+-----------------------------------
   78.44697 |    147,273      100.00      100.00
------------+-----------------------------------
      Total |    147,273      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2011

        top |      Freq.     Percent        Cum.
------------+-----------------------------------
   77.13447 |    145,307      100.00      100.00
------------+-----------------------------------
      Total |    145,307      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2012

        top |      Freq.     Percent        Cum.
------------+-----------------------------------
   74.81236 |    144,530      100.00      100.00
------------+-----------------------------------
      Total |    144,530      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2013

        top |      Freq.     Percent        Cum.
------------+-----------------------------------
   73.29794 |    143,780      100.00      100.00
------------+-----------------------------------
      Total |    143,780      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2014

        top |      Freq.     Percent        Cum.
------------+-----------------------------------
   72.18736 |    144,143      100.00      100.00
------------+-----------------------------------
      Total |    144,143      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2015

        top |      Freq.     Percent        Cum.
------------+-----------------------------------
   71.07679 |    142,008      100.00      100.00
------------+-----------------------------------
      Total |    142,008      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2016

        top |      Freq.     Percent        Cum.
------------+-----------------------------------
   70.97583 |    141,786      100.00      100.00
------------+-----------------------------------
      Total |    141,786      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2017

        top |      Freq.     Percent        Cum.
------------+-----------------------------------
   70.06718 |    139,326      100.00      100.00
------------+-----------------------------------
      Total |    139,326      100.00

------------------------------------------------------------------------------------------------------------
-> year = 2018

        top |      Freq.     Percent        Cum.
------------+-----------------------------------
   68.55276 |    135,322      100.00      100.00
------------+-----------------------------------
      Total |    135,322      100.00


. 
. * check
. gen n = (real_wage >= bottom & real_wage <= top)

. tab topcode if n

    topcode |      Freq.     Percent        Cum.
------------+-----------------------------------
          0 |  3,333,941       98.45       98.45
          1 |     52,452        1.55      100.00
------------+-----------------------------------
      Total |  3,386,393      100.00

. keep if n
(64,602 observations deleted)

. 
. drop n bottom top

. 
. **
. **
. 
. * normalize weights in remaining sample
. by year month, sort: egen total_earnwt = sum( earnwt )

. gen normalized_weights = earnwt / total_earnwt

. sum normalized_weights, d

                     normalized_weights
-------------------------------------------------------------
      Percentiles      Smallest
 1%     9.83e-06       1.43e-06
 5%     .0000133       1.67e-06
10%     .0000174       1.77e-06       Obs           3,386,393
25%     .0000453       1.79e-06       Sum of Wgt.   3,386,393

50%     .0000872                      Mean           .0000827
                        Largest       Std. Dev.      .0000444
75%      .000114       .0008436
90%     .0001358       .0009172       Variance       1.97e-09
95%     .0001507       .0010143       Skewness       .2021414
99%     .0001855       .0012237       Kurtosis       3.518426

. 
. * log wage distribution
. gen log_wage = log( real_wage )

. sum log_wage [w = normalized_weights], d
(analytic weights assumed)

                          log_wage
-------------------------------------------------------------
      Percentiles      Smallest
 1%     1.539685       1.033184
 5%     1.759236       1.033184
10%     1.883883       1.033184       Obs           3,386,393
25%     2.143589       1.033184       Sum of Wgt.         280

50%     2.531393                      Mean           2.579044
                        Largest       Std. Dev.      .5639319
75%     2.956511       4.362423
90%     3.341853       4.362423       Variance       .3180192
95%      3.57655       4.362423       Skewness       .4159971
99%      4.05056       4.362423       Kurtosis       2.807211

. 
. * close log file
. log close
      name:  <unnamed>
       log:  C:\Users\jcrechet\Dropbox\Research\Projects\Heterogeneity_Uflows\Submissions\EER-April 2022\Acc
> epted2023\Replication_files\Stata\Log\2_wages.log
  log type:  text
 closed on:  14 Mar 2023, 19:53:57
------------------------------------------------------------------------------------------------------------
